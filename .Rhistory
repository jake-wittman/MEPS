stats_table_plot_dat[[4]] %>% View()
# Relevel the poverty factors
stats_table_plot_dat[[4]] <- stats_table_plot_dat[[4]] %>%
mutate(strata = factor(strata,
levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'),
ordered = TRUE))
stats_table_plot_dat
stats_table_plot_dat[[4]] %>% View()
stats_table_plot_dat[[4]]
# Relevel the poverty factors
stats_table_plot_dat[[4]] <- stats_table_plot_dat[[4]] %>%
mutate(strata = as.factor(strata))
stats_table_plot_dat[[4]]
?as.factor
stats_table_plot_dat[[4]] %>%
mutate(strata = factor(strata,
levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'),
ordered = TRUE))
stats_table_plot_dat[[4]] %>%
mutate(strata = factor(strata,
levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative')))
# Relevel the poverty factors
stats_table_plot_dat[[4]] <- stats_table_plot_dat[[4]] %>%
mutate(strata = factor(strata,
levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative')))
stats_table_plot_dat
stats_table_plot_dat[[4]]
factor(stats_table_plot_dat[[4]]$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
# Relevel the poverty factors
stats_table_plot_dat[[4]] <- factor(stats_table_plot_dat[[4]]$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
# Relevel the poverty factors
stats_table_plot_dat[[4]]$strata_new <- factor(stats_table_plot_dat[[4]]$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
# Relevel the poverty factors
pov_table <- stats_table_plot_dat[[4]]
pov_table$strata <- factor(pov_table$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
pov_table
stats_table_plot_dat[[4]] <- pov_table
stats_table_plot_dat[[4]]
stats_table_plot_dat[4] <- pov_table
stats_table_plot_dat[[4]]
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
group_split(stratifier)
stats_table_plot_dat
names(stats_table_plot_dat) <- c('age', 'edu', 'ins', 'overall', 'pov', 'race', 'sex')
overall_data <- stats_table_plot_dat[[4]]
overall_data <- stats_table_plot_dat$overall
overall_data
# Relevel the poverty factors
pov_table <- stats_table_plot_dat$pov
pov_table$strata <- factor(pov_table$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
stats_table_plot_dat$pov_table <- pov_table
stats_table_plot_dat$pov <- pov_table
stats_table_plot_dat$pov
stats_table_plot_dat$pov_table
pov_table
?split
?split
?split.data.frame
split(stats_table_plot_dat, stratifier)
split(stats_table_plot_dat, stats_table_plot_dat$stratifier)
split(stats_table_plot_dat, unique(stats_table_plot_dat$stratifier))
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata))
split(stats_table_plot_dat, unique(stats_table_plot_dat$stratifier))
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata))
split(stats_table_plot_dat, unique(stats_table_plot_dat$stratifier))
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., unique(.$stratifier))
stats_table_plot_dat
# Relevel the poverty factors
stats_table_plot_dat$pov$strata <- factor(stats_table_plot_dat$pov$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
stats_table_plot_dat$pov
factor(stats_table_plot_dat$pov$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., unique(.$stratifier))
overall_data <- stats_table_plot_dat$overall
# Remove the overall data from the list
stats_table_plot_dat <- stats_table_plot_dat[-4]
factor(stats_table_plot_dat$pov$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
stats_table_plot_dat$poverty$strata
fct_drop
?fct_drop
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., unique(.$stratifier))
stats_table_plot_dat <- map(stats_table_plot_dat, function(.x) {
.x %>%
mutate(strata = fct_drop(strata))
})
overall_data <- stats_table_plot_dat$overall
# Remove the overall data from the list
stats_table_plot_dat <- stats_table_plot_dat[-4]
stats_table_plot_dat$poverty$strata
stats_table_plot_dat$poverty
stats_table_plot_dat$poverty$strata
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., f = .$stratifier)
stats_table_plot_dat
stats_table_plot_dat <- map(stats_table_plot_dat, function(.x) {
.x %>%
mutate(strata = fct_drop(strata))
})
stats_table_plot_dat
overall_data <- stats_table_plot_dat$overall
# Remove the overall data from the list
stats_table_plot_dat <- stats_table_plot_dat[-4]
stats_table_plot_dat$poverty$strata
# Relevel the poverty factors
stats_table_plot_dat$poverty$strata <- factor(stats_table_plot_dat$poverty$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
stats_table_plot_dat$poverty$strata
test_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_smooth( se = FALSE) +
geom_smooth(data = filter(overall_data, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = age_adjusted_prop * 100),
color = 'black',
se = FALSE,
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(25, 100),
breaks = seq(25, 100, 25),
labels = seq(25, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95)) +
labs(x = 'Year', y = 'Percentage')
)
test_plots[[4]]
test_plots[[1]] <- test_plots[[1]] + labs(color = 'Age (grouped)') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[2]] <- test_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[3]] <- test_plots[[3]] + labs(color = "Insurance") + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[4]] <- test_plots[[4]] + labs(color = 'Poverty') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[5]] <- test_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[6]] <- test_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots <- list(
test_plots[[1]],
test_plots[[6]],
test_plots[[5]],
test_plots[[2]],
test_plots[[3]],
test_plots[[4]]
)
exam_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_smooth(se = FALSE) +
geom_smooth(data = filter(overall_data, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = age_adjusted_prop * 100),
color = 'black',
se = FALSE,
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(25, 100),
breaks = seq(25, 100, 25),
labels = seq(25, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95)) +
labs(x = 'Year', y = 'Percentage')
)
exam_plots[[1]] <- exam_plots[[1]] + labs(color = 'Age (grouped)')
exam_plots[[2]] <- exam_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[3]] <- exam_plots[[3]] + labs(color = "Insurance") + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[4]] <- exam_plots[[4]] + labs(color = 'Poverty') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[5]] <- exam_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[6]] <- exam_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots <- list(
exam_plots[[1]],
exam_plots[[6]],
exam_plots[[5]],
exam_plots[[2]],
exam_plots[[3]],
exam_plots[[4]]
)
exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt'))
stats_table_plot_dat$poverty %>% View()
exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt'))
(all_exam_plots <- exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
ggsave(all_exam_plots,
'figures/all_exam_plots.svg')
?ggsave
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.svg')
renv::install('svglite')
renv::status()
renv::snapshot()
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.svg')
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.svg')
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tif')
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tif')
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff')
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff')
(all_exam_plots <- exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff')
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff')
stats_table_plot_dat$insurance %>% filter(strata == 'Uninsured')
tar_load(age_adjusted_stats)
stats_table_plot_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., f = .$stratifier)
stats_table_plot_dat <- map(stats_table_plot_dat, function(.x) {
.x %>%
mutate(strata = fct_drop(strata))
})
overall_data <- stats_table_plot_dat$overall
# Remove the overall data from the list
stats_table_plot_dat <- stats_table_plot_dat[-4]
# Relevel the poverty factors
stats_table_plot_dat$poverty$strata <- factor(stats_table_plot_dat$poverty$strata, levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'))
test_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_smooth( se = FALSE) +
geom_smooth(data = filter(overall_data, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = age_adjusted_prop * 100),
color = 'black',
se = FALSE,
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(25, 100),
breaks = seq(25, 100, 25),
labels = seq(25, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95)) +
labs(x = 'Year', y = 'Percentage')
)
test_plots[[1]] <- test_plots[[1]] + labs(color = 'Age (grouped)')
test_plots[[2]] <- test_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[3]] <- test_plots[[3]] + labs(color = "Insurance") + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[4]] <- test_plots[[4]] + labs(color = 'Poverty') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[5]] <- test_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots[[6]] <- test_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank())
test_plots <- list(
test_plots[[1]],
test_plots[[6]],
test_plots[[5]],
test_plots[[2]],
test_plots[[3]],
test_plots[[4]]
)
exam_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_smooth(se = FALSE) +
geom_smooth(data = filter(overall_data, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = age_adjusted_prop * 100),
color = 'black',
se = FALSE,
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(25, 100),
breaks = seq(25, 100, 25),
labels = seq(25, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95)) +
labs(x = 'Year', y = 'Percentage')
)
exam_plots[[1]] <- exam_plots[[1]] + labs(color = 'Age (grouped)')
exam_plots[[2]] <- exam_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[3]] <- exam_plots[[3]] + labs(color = "Insurance") + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[4]] <- exam_plots[[4]] + labs(color = 'Poverty') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[5]] <- exam_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots[[6]] <- exam_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank())
exam_plots <- list(
exam_plots[[1]],
exam_plots[[6]],
exam_plots[[5]],
exam_plots[[2]],
exam_plots[[3]],
exam_plots[[4]]
)
(all_exam_plots <- exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff')
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff')
tar_load(age_adjusted_stats)
age_adjusted_stats %>%
#filter(stratifier != 'age') %>%
mutate(age_adjusted_prop = age_adjusted_prop * 100) %>%
pivot_wider(
id_cols = c(stratifier, variable, var_label, strata),
names_from = year,
values_from = age_adjusted_prop
) %>%
group_by(stratifier, strata) %>%
select(stratifier, var_label, `2008`:`2020`) %>%
gt() %>%
fmt_number(columns = `2008`:`2020`, decimals = 1) %>%
gtsave('table_test.docx')
?ggsave
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff',
dpi = 200)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff',
dpi = 200)
tar_load(diab_dat)
diab_dat
diab_dat %>%
summarise(across(ends_with('practices'), ~mean(.x, na.rm = TRUE)))
diab_dat %>%
select(ends_with('practices')) %>%
tbl_summary()
?tbl_summary
diab_dat %>%
select(ends_with('practices'))
diab_dat %>%
select(ends_with('practices'), -sum_practices) %>%
tbl_summary()
