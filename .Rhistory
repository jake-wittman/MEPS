'z' = 'dashed'
)
) +
labs(caption = "ᵃ p < 0.05 for eye-exam \nᵇ p < 0.05 for foot exam \nᶜ p < 0.05 for dentist visit")
exam_plots_sans_2020[[5]] <-
exam_plots_sans_2020[[5]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Race & Ethnicity',
labels = c(
'Asian/Not Hispanic' = 'Asian/Not Hispanic',
'Black/Not Hispanic' = 'Black/Not Hispanic',
'Hispanic'           = 'Hispanic',
'White/Not Hispanic' = 'White/Not Hispanicᶜ',
'z'                  = 'Overallᵇ'
),
values = c(
'Asian/Not Hispanic' = color_pal[1],
'Black/Not Hispanic' = color_pal[2],
'Hispanic'           = color_pal[3],
'White/Not Hispanic' = color_pal[4],
'z'                  = '#000000'
)
) +
scale_linetype_manual(
name = 'Race & Ethnicity',
labels = c(
'Asian/Not Hispanic' = 'Asian/Not Hispanic',
'Black/Not Hispanic' = 'Black/Not Hispanic',
'Hispanic'           = 'Hispanic',
'White/Not Hispanic' = 'White/Not Hispanicᶜ',
'z'                  = 'Overallᵇ'
),
values = c(
'Asian/Not Hispanic' = 'solid',
'Black/Not Hispanic'  = 'solid',
'Hispanic' = 'solid',
'White/Not Hispanic' = 'solid',
'z' = 'dashed'
)
)
exam_plots_sans_2020[[6]] <-
exam_plots_sans_2020[[6]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Sex',
labels = c('Female'  = 'Female',
'Male'    = 'Maleᵃ',
'z' = 'Overallᵇ'),
values = c(
'Female' = color_pal[1],
'Male'  = color_pal[2],
'z' = '#000000'
)
) +
scale_linetype_manual(
name = 'Sex',
labels = c('Female' = 'Female',
'Male' = 'Maleᵃ',
'z' = 'Overallᵇ'),
values = c(
'Female' = 'solid',
'Male'  = 'solid',
'z' = 'dashed'
)
)
exam_plots_sans_2020 <- list(
exam_plots_sans_2020[[1]],
exam_plots_sans_2020[[6]],
exam_plots_sans_2020[[5]],
exam_plots_sans_2020[[2]],
exam_plots_sans_2020[[3]],
exam_plots_sans_2020[[4]]
)
all_exam_plots_sans_2020 <- exam_plots_sans_2020 %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt'),
legend.justification = 'left',
plot.caption = element_text(hjust = 0)) &
guides(color = guide_legend(ncol = 2))
all_test_plots_sans_2020 <- test_plots_sans_2020 %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt'),
legend.justification = 'left',
plot.caption = element_text(hjust = 0)) &
guides(color = guide_legend(ncol = 2))
# Chunk 6
#| include: false
# Save figure/table output
preventive_practice_table %>%
gtsave('preventive_practices.docx')
preventive_practice_table_sans_2020 %>%
gtsave('preventive_practices_2020.docx')
ggsave(plot = all_exam_plots_sans_2020,
filename = 'figures/all_exam_plots.tiff',
dpi = 1200,
width = 10,
height = 6)
ggsave(plot = all_test_plots_sans_2020,
filename = 'figures/all_test_plots.tiff',
dpi = 1200,
width = 10,
height = 6)
# ggsave(plot = all_exam_plots,
#        filename = 'figures/all_exam_plots.svg',
#        dpi = 200,
#        width = 10,
#        height = 6)
# ggsave(plot = all_test_plots,
#        filename = 'figures/all_test_plots.svg',
#        dpi = 200,
#        width = 10,
#        height = 6)
# Chunk 7: tbl-prev
#| label: tbl-prev
#| tbl-cap: Age-adjusted trends in proportions of US adults with diabetes that report receiving at least three of six recommended care practices - at least one dental visit, one eye exam with dilation, one foot exam, two or more A1C tests, cholesterol level tested, and receiving a flu vaccine.
proportion_table_sans_2020 %>%
tab_header("Age-adjusted trends in proportions of US adults with diabetes that report receiving recommended care practices - at least one dental visit, one eye exam with dilation, one foot exam, two or more A1C tests, cholesterol level tested, and receiving a flu vaccine.")
# Chunk 8: fig-exams
#| label: fig-exams
#| fig-cap: Age-adjusted trends in proportions of US adults with diabetes who reported receiving recommended medical examinations from 2008 - 2019. The dashed black line is the overall trend, while dots represent percentages for 2020. Data from 2020 was not included in the trend analysis.
#| fig-width: 8
all_exam_plots_sans_2020
# Chunk 9: fig-tests
#| label: fig-tests
#| fig-cap: Age-adjusted trends in proportions of US adults with diabetes who reported receiving recommended lab tests and vaccinations. The dashed black line is the overall trend, while dots represent percentages for 2020. Data from 2020 was not included in the trend analysis.
#| fig-width: 10
all_test_plots_sans_2020
# Chunk 10: tbl-prop
#| label: tbl-prop
#| tbl-cap: Age-adjusted trends in proportions of US adults with diabetes that report receiving six recommended care practices - at least one dental visit, one eye exam with dilation, one foot exam, two or more A1C tests, cholesterol level tested, and receiving a flu vaccine.
supplement_prop_tab %>%
tab_header('Age-adjusted trends in proportions of US adults overall and by subgroup with diabetes that report receiving six recommended care practices - at least one dental visit, one eye exam with dilation, one foot exam, two or more A1C tests, cholesterol level tested, and receiving a flu vaccine.')
# Chunk 11
#| include: false
#| echo: false
# Create plots with actual proportions and standard errors
supp_dat <- age_adjusted_stats %>%
filter(strata != 'Total') %>%
filter(stratifier != 'overall') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
filter(strata != 'Other') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata),
year_adj = year - 2007) %>%
mutate(strata = as.factor(strata)) %>%
split(., f = .$stratifier)
supp_dat <- map(supp_dat, function(.x) {
.x %>%
mutate(strata = fct_drop(strata))
})
supp_dat$poverty$strata <-
factor(
supp_dat$poverty$strata,
levels = c('Poor/Negative', 'Low income', 'Middle income', 'High income'),
labels = c(
'd< 100%',
'c100% - 199%',
'b200% - 399%',
'a> 400% '
),
ordered = TRUE
)
supplemental_test_plots <-
map(
supp_dat,
~ ggplot(
filter(.x, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = p,
group = strata,
color = strata
)
) +
geom_point() +
geom_errorbar(
aes(ymin = p - 1.96 * (p.std.error * 100),
ymax = p + 1.96 * (p.std.error * 100))
) +
facet_wrap(~ variable_text, ncol = 3, scales = 'free_y') +
theme_classic() +
scale_x_continuous(
limits = c(2007.5, 2020.5),
breaks = seq(2008, 2020, 2),
labels = c(2008, "", 2012, "", 2016, "", 2020)
) +
theme(
axis.text = element_text(color = 'black'),
#axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 11),
legend.text = element_text(size = 9)
) +
labs(x = 'Year', y = 'Percentage')
)
supplemental_exam_plots <-
map(
supp_dat,
~ ggplot(
filter(.x, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = p,
group = strata,
color = strata
)
) +
geom_point() +
geom_errorbar(
aes(ymin = p - 1.96 * (p.std.error * 100),
ymax = p + 1.96 * (p.std.error * 100))
) +
facet_wrap(~ variable_text, ncol = 3, scales = 'free_y') +
theme_classic() +
scale_x_continuous(
limits = c(2007.5, 2020.5),
breaks = seq(2008, 2020, 2),
labels = c(2008, "", 2012, "", 2016, "", 2020)
) +
theme(
axis.text = element_text(color = 'black'),
#axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 11),
legend.text = element_text(size = 9)
) +
labs(x = 'Year', y = 'Percentage')
)
supplemental_test_plots[[1]] <-
supplemental_test_plots[[1]] +
theme(axis.title.x = element_blank()) +
scale_color_manual(
name = 'Age (grouped)',
values = c(
'18 to 44' = color_pal[1],
'45 to 64'  = color_pal[2],
'65 to 74' = color_pal[3],
'75+' = color_pal[4]
),
labels = c('18 to 44' = '18 to 44',
'45 to 64' = '45 to 64',
'65 to 74' = '65 to 74',
'75+'      = '75+')
)
supplemental_test_plots[[2]] <-
supplemental_test_plots[[2]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Highest degree obtained',
labels = c('Greater than HS'       = 'Greater than HS',
'High school'           = 'High school',
'Less than high school' = 'Less than HS'),
values = c(
'Greater than HS' = color_pal[1],
'High school' = color_pal[2],
'Less than high school'  = color_pal[3]
)
)
supplemental_test_plots[[3]] <-
supplemental_test_plots[[3]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Insurance',
values = c(
'Medicaid' = color_pal[1],
'Medicare only' = color_pal[2],
'Private only' = color_pal[3],
'Uninsured' = color_pal[4]
),   labels = c(
'Medicaid'      = 'Medicaid',
'Medicare only' = 'Medicare only',
'Private only'  = 'Private only',
'Uninsured'     = 'Uninsured'
)
)
supplemental_test_plots[[4]] <-
supplemental_test_plots[[4]] +
theme(strip.background =  element_blank(),
strip.text = element_blank()) +
scale_color_manual(
name = 'Poverty income ratio',
labels = c('a> 400% '     = '> 400%',
'b200% - 399%' = '200% - 399%',
'c100% - 199%' = '100% - 199%',
'd< 100%'      = '< 100%'),
values = c(
'a> 400% ' = color_pal[1],
'b200% - 399%' = color_pal[2],
'c100% - 199%' = color_pal[3],
'd< 100%' = color_pal[4]
)
)
supplemental_test_plots[[5]] <-
supplemental_test_plots[[5]] + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Race & Ethnicity',
labels = c(
'Asian/Not Hispanic' = 'Asian/Not Hispanic',
'Black/Not Hispanic' = 'Black/Not Hispanic',
'Hispanic'           = 'Hispanic',
'White/Not Hispanic' = 'White/Not Hispanic'
),
values = c(
'Asian/Not Hispanic' = color_pal[1],
'Black/Not Hispanic'  = color_pal[2],
'Hispanic' = color_pal[3],
'White/Not Hispanic' = color_pal[4]
)
)
supplemental_test_plots[[6]] <-
supplemental_test_plots[[6]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Sex',
labels = c('Female'  = 'Female',
'Male'    = 'Male'),
values = c(
'Female' = color_pal[1],
'Male'  = color_pal[2]
)
)
supplemental_test_plots <- list(
supplemental_test_plots[[1]],
supplemental_test_plots[[6]],
supplemental_test_plots[[5]],
supplemental_test_plots[[2]],
supplemental_test_plots[[3]],
supplemental_test_plots[[4]]
)
# Set up legends on all plots
supplemental_exam_plots[[1]] <- supplemental_exam_plots[[1]] +
theme(axis.title.x = element_blank()) +
scale_color_manual(
name = 'Age (grouped)',
labels = c('18 to 44' = '18 to 44',
'45 to 64' = '45 to 64',
'65 to 74' = '65 to 74',
'75+'      = '75+'),
values =   c(
'18 to 44' = color_pal[1],
'45 to 64' = color_pal[2],
'65 to 74' = color_pal[3],
'75+'      = color_pal[4]
)
)
supplemental_exam_plots[[2]] <-
supplemental_exam_plots[[2]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Highest degree obtained',
labels = c('Greater than HS'       = 'Greater than HS',
'High school'           = 'High school',
'Less than high school' = 'Less than HS'),
values = c(
'Greater than HS'       = color_pal[1],
'High school'           = color_pal[2],
'Less than high school' = color_pal[3]
)
)
supplemental_exam_plots[[3]] <-
supplemental_exam_plots[[3]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Insurance',
labels = c(
'Medicaid'      =  'Medicaid',
'Medicare only' =  'Medicare only',
'Private only'  =  'Private only',
'Uninsured'     =  'Uninsured'
),
values = c(
'Medicaid'      = color_pal[1],
'Medicare only' = color_pal[2],
'Private only'  = color_pal[3],
'Uninsured'     = color_pal[4]
)
)
supplemental_exam_plots[[4]] <-
supplemental_exam_plots[[4]] +
theme(strip.background =  element_blank(),
strip.text = element_blank()) +
scale_color_manual(
name = 'Poverty income ratio',
labels = c('a> 400% '     = '> 400%',
'b200% - 399%' = '200% - 399%',
'c100% - 199%' = '100% - 199%',
'd< 100%'      = '< 100%'),
values = c(
'a> 400% '     = color_pal[1],
'b200% - 399%' = color_pal[2],
'c100% - 199%' = color_pal[3],
'd< 100%'      = color_pal[4]
)
)
supplemental_exam_plots[[5]] <-
supplemental_exam_plots[[5]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Race & Ethnicity',
labels = c(
'Asian/Not Hispanic' = 'Asian/Not Hispanic',
'Black/Not Hispanic' = 'Black/Not Hispanic',
'Hispanic'           = 'Hispanic',
'White/Not Hispanic' = 'White/Not Hispanic'
),
values = c(
'Asian/Not Hispanic' = color_pal[1],
'Black/Not Hispanic' = color_pal[2],
'Hispanic'           = color_pal[3],
'White/Not Hispanic' = color_pal[4]
)
)
supplemental_exam_plots[[6]] <-
supplemental_exam_plots[[6]] +
theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
) +
scale_color_manual(
name = 'Sex',
labels = c('Female'  = 'Female',
'Male'    = 'Male'),
values = c(
'Female' = color_pal[1],
'Male'  = color_pal[2]
)
)
supplemental_exam_plots <- list(
supplemental_exam_plots[[1]],
supplemental_exam_plots[[6]],
supplemental_exam_plots[[5]],
supplemental_exam_plots[[2]],
supplemental_exam_plots[[3]],
supplemental_exam_plots[[4]]
)
supplemental_all_exam <- supplemental_exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt'),
legend.justification = 'left',
plot.caption = element_text(hjust = 0)) &
guides(color = guide_legend(ncol = 2))
supplemental_all_test <- supplemental_test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt'),
legend.justification = 'left',
plot.caption = element_text(hjust = 0)) &
guides(color = guide_legend(ncol = 2))
ggsave(plot = supplemental_all_exam,
filename = 'figures/supp_exam_plots.tiff',
dpi = 1200,
width = 10,
height = 6)
ggsave(plot = supplemental_all_test,
filename = 'figures/supp_test_plots.tiff',
dpi = 1200,
width = 10,
height = 6)
# Chunk 12
#| fig-cap: Age-adjusted proportions with 95% confidence intervals of US adults with diabetes who reported receiving recommended medical examinations from 2008 - 2020.
supplemental_all_exam
# Chunk 13
#| fig-cap: Age-adjusted proportions with 95% confidence intervals of US adults with diabetes who reported receiving recommended lab tests and vaccinations from 2008 - 2020.
supplemental_all_test
tar_load(diab_dat)
diab_dat
diab_dat %>% filter(DIABW > 0)
diab_dat %>% filter(DIABW > 0) %>% group_by(year) %>% count()
diab_dat %>% filter(DIABW > 0, !is.na(DSA1C53)) %>% group_by(year) %>% count()
