axis.title.x = element_blank())
test_plots <- list(
test_plots[[1]],
test_plots[[6]],
test_plots[[5]],
test_plots[[2]],
test_plots[[3]],
test_plots[[4]]
)
exam_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_line(aes(x = year, y = model * 100, group = strata, color = strata)) +
geom_line(data = filter(overall_data, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = model * 100),
color = 'black',
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(  0, 100),
breaks = seq(0, 100, 25),
labels = seq(0, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 10),
legend.text = element_text(size = 8)) +
labs(x = 'Year', y = 'Percentage')
)
exam_plots[[1]] <- exam_plots[[1]] + labs(color = 'Age (grouped)') +
theme(axis.title.x = element_blank())
exam_plots[[2]] <-
exam_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
exam_plots[[3]] <-
exam_plots[[3]] + labs(color = "Insurance") + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
exam_plots[[4]] <-
exam_plots[[4]] + labs(color = 'Income as % of \npoverty line') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
exam_plots[[5]] <-
exam_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
exam_plots[[6]] <-
exam_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank())
exam_plots <- list(
exam_plots[[1]],
exam_plots[[6]],
exam_plots[[5]],
exam_plots[[2]],
exam_plots[[3]],
exam_plots[[4]]
)
(all_exam_plots <- exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff',
dpi = 200,
width = 11,
height = 6.5)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff',
dpi = 200,
width = 11,
height = 6.5)
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.svg',
dpi = 200,
width = 11,
height = 6.5)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.svg',
dpi = 200,
width = 11,
height = 6.5)
tar_load(age_adjusted_stats)
tar_load(jp_proportion_plot_data)
stats_table_plot_dat <- jp_proportion_plot_data %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., f = .$stratifier)
stats_table_plot_dat <- map(stats_table_plot_dat, function(.x) {
.x %>%
mutate(strata = fct_drop(strata))
})
overall_data <- stats_table_plot_dat$overall
# Remove the overall data from the list
stats_table_plot_dat <- stats_table_plot_dat[-4]
# Relevel the poverty factors
stats_table_plot_dat$poverty$strata <-
factor(
stats_table_plot_dat$poverty$strata,
levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'),
labels = c(
'> 400% ',
'200% - 399%',
'100% - 199%',
'< 100%'
)
)
test_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_line(aes(x = year, y = model * 100, group = strata, color = strata)) +
geom_line(data = filter(overall_data, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = model * 100),
color = 'black',
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(00, 100),
breaks = seq(0, 100, 25),
labels = seq(0, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 8),
legend.text = element_text(size = 6)) +
labs(x = 'Year', y = 'Percentage')
)
test_plots[[1]] <- test_plots[[1]] + labs(color = 'Age (grouped)') +
theme(axis.title.x = element_blank())
test_plots[[2]] <-
test_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
test_plots[[3]] <-
test_plots[[3]] + labs(color = "Insurance") + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
test_plots[[4]] <-
test_plots[[4]] + labs(color = 'Income as % of \npoverty line') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
test_plots[[5]] <-
test_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
test_plots[[6]] <-
test_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank())
test_plots <- list(
test_plots[[1]],
test_plots[[6]],
test_plots[[5]],
test_plots[[2]],
test_plots[[3]],
test_plots[[4]]
)
exam_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_line(aes(x = year, y = model * 100, group = strata, color = strata)) +
geom_line(data = filter(overall_data, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = model * 100),
color = 'black',
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(  0, 100),
breaks = seq(0, 100, 25),
labels = seq(0, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 8),
legend.text = element_text(size = 6)) +
labs(x = 'Year', y = 'Percentage')
)
exam_plots[[1]] <- exam_plots[[1]] + labs(color = 'Age (grouped)') +
theme(axis.title.x = element_blank())
exam_plots[[2]] <-
exam_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
exam_plots[[3]] <-
exam_plots[[3]] + labs(color = "Insurance") + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
exam_plots[[4]] <-
exam_plots[[4]] + labs(color = 'Income as % of \npoverty line') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
exam_plots[[5]] <-
exam_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
exam_plots[[6]] <-
exam_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank())
exam_plots <- list(
exam_plots[[1]],
exam_plots[[6]],
exam_plots[[5]],
exam_plots[[2]],
exam_plots[[3]],
exam_plots[[4]]
)
(all_exam_plots <- exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff',
dpi = 200,
width = 11,
height = 6.5)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff',
dpi = 200,
width = 11,
height = 6.5)
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.svg',
dpi = 200,
width = 11,
height = 6.5)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.svg',
dpi = 200,
width = 11,
height = 6.5)
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
tar_load(age_adjusted_stats)
tar_load(jp_proportion_plot_data)
stats_table_plot_dat <- jp_proportion_plot_data %>%
filter(strata != 'Total') %>%
filter(strata != 'Not available') %>%
filter(strata != 'Other Race/Not Hispanic') %>%
mutate(variable_text = case_when(variable == 'a1c' ~ '2 or more A1C tests',
variable == 'CHOL_all' ~ 'Cholesterol tested',
variable == 'DENT_all' ~ '1 or more dentist visits',
variable == 'eye-exam' ~ 'Eye exam with dilation',
variable == 'flu' ~ 'Received flu vaccine',
variable == 'foot' ~ 'Foot examination'),
strata = case_when(strata == 'stat_0' ~ 'Overall',
TRUE ~ strata)) %>%
mutate(strata = as.factor(strata)) %>%
split(., f = .$stratifier)
stats_table_plot_dat <- map(stats_table_plot_dat, function(.x) {
.x %>%
mutate(strata = fct_drop(strata))
})
overall_data <- stats_table_plot_dat$overall
# Remove the overall data from the list
stats_table_plot_dat <- stats_table_plot_dat[-4]
# Relevel the poverty factors
stats_table_plot_dat$poverty$strata <-
factor(
stats_table_plot_dat$poverty$strata,
levels = c('High income', 'Middle income', 'Low income', 'Poor/Negative'),
labels = c(
'> 400% ',
'200% - 399%',
'100% - 199%',
'< 100%'
)
)
test_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_line(aes(x = year, y = model * 100, group = strata, color = strata)) +
geom_line(data = filter(overall_data, variable %in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = model * 100),
color = 'black',
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(00, 100),
breaks = seq(0, 100, 25),
labels = seq(0, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 8),
legend.text = element_text(size = 6)) +
labs(x = 'Year', y = 'Percentage')
)
test_plots[[1]] <- test_plots[[1]] + labs(color = 'Age (grouped)') +
theme(axis.title.x = element_blank())
test_plots[[2]] <-
test_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
test_plots[[3]] <-
test_plots[[3]] + labs(color = "Insurance") + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
test_plots[[4]] <-
test_plots[[4]] + labs(color = 'Income as % of \npoverty line') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
test_plots[[5]] <-
test_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
test_plots[[6]] <-
test_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank())
test_plots <- list(
test_plots[[1]],
test_plots[[6]],
test_plots[[5]],
test_plots[[2]],
test_plots[[3]],
test_plots[[4]]
)
exam_plots <- stats_table_plot_dat %>%
map(
~ ggplot(filter(.x, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(
x = year,
y = age_adjusted_prop * 100,
group = strata,
color = strata
)) +
#geom_point() +
geom_line(aes(x = year, y = model * 100, group = strata, color = strata)) +
geom_line(data = filter(overall_data, variable %!in% c('a1c', 'CHOL_all', 'flu')),
aes(x = year, y = model * 100),
color = 'black',
linetype = 'dashed') +
facet_wrap( ~ variable_text, ncol = 3) +
theme_classic() +
scale_y_continuous(
limits = c(  0, 100),
breaks = seq(0, 100, 25),
labels = seq(0, 100, 25)
) +
scale_x_continuous(
limits = c(2008, 2020),
breaks = seq(2008, 2020, 2),
labels = seq(2008, 2020, 2)
) +
scale_color_brewer(type = 'qual', palette = 'Set2') +
theme(axis.text = element_text(color = 'black'),
axis.text.x = element_text(angle = 45, hjust = 0.9, vjust = 0.95),
legend.title = element_text(size = 8),
legend.text = element_text(size = 6)) +
labs(x = 'Year', y = 'Percentage')
)
exam_plots[[1]] <- exam_plots[[1]] + labs(color = 'Age (grouped)') +
theme(axis.title.x = element_blank())
exam_plots[[2]] <-
exam_plots[[2]] + labs(color = 'Highest degree \nobtained') + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
exam_plots[[3]] <-
exam_plots[[3]] + labs(color = "Insurance") + theme(
strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank()
)
exam_plots[[4]] <-
exam_plots[[4]] + labs(color = 'Income as % of \npoverty line') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
exam_plots[[5]] <-
exam_plots[[5]] + labs(color = 'Race/Ethnicity') + theme(
strip.background =  element_blank(),
strip.text = element_blank()
)
exam_plots[[6]] <-
exam_plots[[6]] + labs(color = 'Sex') + theme(strip.background =  element_blank(),
strip.text = element_blank(),
axis.title.x = element_blank())
exam_plots <- list(
exam_plots[[1]],
exam_plots[[6]],
exam_plots[[5]],
exam_plots[[2]],
exam_plots[[3]],
exam_plots[[4]]
)
(all_exam_plots <- exam_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
(all_test_plots <- test_plots %>%
wrap_plots(nrow = 6) &
theme(plot.margin = margin(0.5, 0.5, 0.5, 0.5, 'pt')))
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.tiff',
dpi = 200,
width = 10,
height = 7)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.tiff',
dpi = 200,
width = 10,
height = 7)
ggsave(plot = all_exam_plots,
filename = 'figures/all_exam_plots.svg',
dpi = 200,
width = 10,
height = 7)
ggsave(plot = all_test_plots,
filename = 'figures/all_test_plots.svg',
dpi = 200,
width = 10,
height = 7)
